{"version":3,"file":"user-action.umd.js","sources":["lib/UserActionBroker.js","user-action.umd.js"],"sourcesContent":["/**\n * Broker user actions in a normalized way which is abstracted from xAPI\n * but yet mirrors much of that structure and data needs.\n */\nexport class UserActionBroker {\n  /**\n   * @todo ensure a singleton design pattern\n   */\n  constructor() {\n    // set the built in events w/ support for others\n    this.eventList = {\n      click: \"click\",\n      visibility: \"visibility\",\n      keypress: \"keypress\"\n    };\n  }\n  /**\n   * See if this is a valid event\n   */\n  valid(event) {\n    if (this.eventList[event]) {\n      return true;\n    }\n    return false;\n  }\n  /**\n   * Fire the action for the user engagement broker.\n   */\n  fireAction(eventType, details, context) {\n    details.eventType = eventType;\n    context.dispatchEvent(\n      new CustomEvent(\"user-engagement\", {\n        bubbles: true,\n        composed: true,\n        cancelable: false,\n        detail: details\n      })\n    );\n  }\n}\n","/**\n * Copyright 2019 The Pennsylvania State University\n * @license Apache-2.0, see License.md for full text.\n */\nimport { HAXWiring } from \"@lrnwebcomponents/hax-body-behaviors/lib/HAXWiring.js\";\nimport { UserActionBroker } from \"./lib/UserActionBroker.js\";\n/**\n * `user-action`\n * `track user actions and allow them to talk to xAPI stores easily`\n *\n * @microcopy - language worth noting:\n *  -\n *\n * @customElement\n * @demo demo/index.html\n */\nclass UserAction extends HTMLElement {\n  \n  // render function\n  get html() {\n    return `\n<style></style>\n<slot></slot>`;\n  }\n\n  // haxProperty definition\n  static get haxProperties() {\n    return {\n  \"canScale\": true,\n  \"canPosition\": true,\n  \"canEditSource\": false,\n  \"gizmo\": {\n    \"title\": \"User action\",\n    \"description\": \"track user actions and allow them to talk to xAPI stores easily\",\n    \"icon\": \"icons:android\",\n    \"color\": \"green\",\n    \"groups\": [\"Action\"],\n    \"handles\": [\n      {\n        \"type\": \"inline\",\n        \"text\": \"\"\n      }\n    ],\n    \"meta\": {\n      \"author\": \"btopro\",\n      \"owner\": \"The Pennsylvania State University\"\n    }\n  },\n  \"settings\": {\n    \"quick\": [],\n    \"configure\": [\n      {\n        \"attribute\": \"track\",\n        \"title\": \"Track when the user: \",\n        \"description\": \"What event to react to\",\n        \"inputMethod\": \"select\",\n        \"options\": {\n          \"visibility\": \"Can see this\",\n          \"keypress\": \"Presses a key here\",\n          \"click\": \"Clicks this\"\n        },\n        \"required\": true,\n        \"icon\": \"icons:android\"\n      },\n      {\n        \"attribute\": \"every\",\n        \"title\": \"Track every event\",\n        \"description\": \"Default behavior is just to track the first occurance\",\n        \"inputMethod\": \"boolean\",\n        \"required\": false,\n        \"icon\": \"icons:android\"\n      },\n      {\n        \"slot\": \"\",\n        \"title\": \"Content\",\n        \"description\": \"Content that can emit events\",\n        \"inputMethod\": \"code-editor\",\n        \"required\": false,\n        \"icon\": \"icons:android\"\n      }\n    ],\n    \"advanced\": []\n  }\n}\n;\n  }\n  // properties available to the custom element for data binding\n  static get properties() {\n    return {\n  \"track\": {\n    \"name\": \"track\",\n    \"type\": \"String\",\n    \"value\": \"visibility\"\n  },\n  \"every\": {\n    \"name\": \"every\",\n    \"type\": \"Boolean\",\n    \"value\": false\n  },\n  \"visiblelimit\": {\n    \"name\": \"visiblelimit\",\n    \"type\": \"Number\",\n    \"value\": 0.5\n  }\n}\n;\n  }\n\n  /**\n   * Store the tag name to make it easier to obtain directly.\n   * @notice function name must be here for tooling to operate correctly\n   */\n  static get tag() {\n    return \"user-action\";\n  }\n  /**\n   * life cycle\n   */\n  constructor(delayRender = false) {\n    super();\n    // set tag for later use\n    this.tag = UserAction.tag;\n    // map our imported properties json to real props on the element\n    // @notice static getter of properties is built via tooling\n    // to edit modify src/user-action-properties.json\n    let obj = UserAction.properties;\n    for (let p in obj) {\n      if (obj.hasOwnProperty(p)) {\n        if (this.hasAttribute(p)) {\n          let val = this.getAttribute(p);\n          if (obj[p].type === \"Boolean\") {\n            val = true;\n          }\n          this[p] = val;\n        } else {\n          this[p] = obj[p].value;\n        }\n      }\n    }\n    this.UserActionBroker = new UserActionBroker();\n  }\n  /**\n   * life cycle, element is afixed to the DOM\n   */\n  connectedCallback() {\n    this.__ready = true;\n    this.HAXWiring = new HAXWiring();\n    this.HAXWiring.setup(UserAction.haxProperties, UserAction.tag, this);\n  }\n\n  static get observedAttributes() {\n    return [\"track\"];\n  }\n\n  attributeChangedCallback(attr, oldValue, newValue) {\n    if (attr === \"track\" && newValue) {\n      switch (newValue) {\n        // visibility isn't a real event and needs a complex solution\n        case \"visibility\":\n          // set an interaction observer\n          this.observer = new IntersectionObserver(\n            this.handleIntersectionCallback.bind(this),\n            {\n              root: document.rootElement,\n              rootMargin: \"0px\",\n              threshold: [0.0, 0.25, 0.5, 0.75, 1.0]\n            }\n          );\n          this.observer.observe(this);\n          break;\n        default:\n          this.addEventListener(newValue, this.userActionEvent.bind(this));\n          break;\n      }\n    }\n  }\n  /**\n   * Handle this being visible\n   */\n  handleIntersectionCallback(entries) {\n    for (let entry of entries) {\n      if (Number(entry.intersectionRatio).toFixed(2) >= this.visiblelimit) {\n        if (this.__ready) {\n          this.userActionEvent({ detail: \"visible\" });\n        }\n      }\n    }\n  }\n  /**\n   * Redirect event we were monitoring into a trackable event\n   */\n  userActionEvent(e) {\n    if (\n      (!this.fired || this.every) &&\n      this.UserActionBroker.valid(this.track)\n    ) {\n      this.UserActionBroker.fireAction(this.track, e, this);\n      this.fired = true;\n    } else if (!this.UserActionBroker.valid(this.track)) {\n      console.warn(this.track + \" was not valid\");\n    }\n  }\n}\nwindow.customElements.define(UserAction.tag, UserAction);\nexport { UserAction };\n"],"names":["UserActionBroker","eventList","click","visibility","keypress","event","this","eventType","details","context","dispatchEvent","CustomEvent","bubbles","composed","cancelable","detail","UserAction","tag","obj","properties","p","hasOwnProperty","_this","hasAttribute","val","getAttribute","type","value","HTMLElement","__ready","HAXWiring","setup","haxProperties","attr","oldValue","newValue","observer","IntersectionObserver","handleIntersectionCallback","bind","root","document","rootElement","rootMargin","threshold","observe","addEventListener","userActionEvent","entries","entry","Number","intersectionRatio","toFixed","visiblelimit","e","fired","every","valid","track","console","warn","fireAction","window","customElements","define"],"mappings":"m9DAIaA,EAAb,uCAMSC,UAAY,CACfC,MAAO,QACPC,WAAY,aACZC,SAAU,oDAMRC,WACAC,KAAKL,UAAUI,sCAQVE,EAAWC,EAASC,GAC7BD,EAAQD,UAAYA,EACpBE,EAAQC,cACN,IAAIC,YAAY,kBAAmB,CACjCC,SAAS,EACTC,UAAU,EACVC,YAAY,EACZC,OAAQP,WA/BhB,GCYMQ,uEAyGGC,IAAMD,EAAWC,QAIlBC,EAAMF,EAAWG,eAChB,IAAIC,KAAKF,KACRA,EAAIG,eAAeD,MACjBE,EAAKC,aAAaH,GAAI,KACpBI,EAAMF,EAAKG,aAAaL,GACR,YAAhBF,EAAIE,GAAGM,OACTF,GAAM,KAEHJ,GAAKI,SAELJ,GAAKF,EAAIE,GAAGO,eAIlB3B,iBAAmB,IAAIA,kPA3HP4B,qIAWd,WACG,eACG,iBACE,QACR,OACE,0BACM,uEACP,sBACC,eACC,CAAC,kBACA,CACT,MACU,cACA,UAGJ,QACI,eACD,+CAGD,OACD,aACI,CACX,WACe,cACJ,oCACM,qCACA,iBACJ,YACK,wBACF,2BACH,yBAEC,OACJ,iBAEV,WACe,cACJ,gCACM,oEACA,oBACH,OACJ,iBAEV,MACU,SACC,sBACM,2CACA,wBACH,OACJ,2BAGA,8CAOL,OACA,MACC,aACA,eACC,oBAEF,MACC,aACA,iBACC,gBAEK,MACN,oBACA,eACC,uCAWF,sEAgCFC,SAAU,OACVC,UAAY,IAAIA,iBAChBA,UAAUC,MAAMf,EAAWgB,cAAehB,EAAWC,IAAKX,uDAOxC2B,EAAMC,EAAUC,MAC1B,UAATF,GAAoBE,SACdA,OAED,kBAEEC,SAAW,IAAIC,qBAClB/B,KAAKgC,2BAA2BC,KAAKjC,MACrC,CACEkC,KAAMC,SAASC,YACfC,WAAY,MACZC,UAAW,CAAC,EAAK,IAAM,GAAK,IAAM,UAGjCR,SAASS,QAAQvC,yBAGjBwC,iBAAiBX,EAAU7B,KAAKyC,gBAAgBR,KAAKjC,2DAQvC0C,0CACPA,iDAAS,KAAlBC,UACHC,OAAOD,EAAME,mBAAmBC,QAAQ,IAAM9C,KAAK+C,cACjD/C,KAAKuB,cACFkB,gBAAgB,CAAEhC,OAAQ,wIAQvBuC,GAEVhD,KAAKiD,QAASjD,KAAKkD,QACrBlD,KAAKN,iBAAiByD,MAAMnD,KAAKoD,OAIvBpD,KAAKN,iBAAiByD,MAAMnD,KAAKoD,QAC3CC,QAAQC,KAAKtD,KAAKoD,MAAQ,wBAHrB1D,iBAAiB6D,WAAWvD,KAAKoD,MAAOJ,EAAGhD,WAC3CiD,OAAQ,sDA9CR,CAAC,kBAoDZO,OAAOC,eAAeC,OAAOhD,EAAWC,IAAKD"}