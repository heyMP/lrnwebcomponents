{"version":3,"file":"wysiwyg-hax.umd.js","sources":["wysiwyg-hax.umd.js"],"sourcesContent":["import { html, PolymerElement } from \"@polymer/polymer/polymer-element.js\";\nimport \"@lrnwebcomponents/cms-hax/cms-hax.js\";\nimport { FlattenedNodesObserver } from \"@polymer/polymer/lib/utils/flattened-nodes-observer.js\";\n\n/**\n * `wysiwyg-hax`\n * `Integration of wysiwyg edit form for a page with HAX.`\n */\nclass WysiwygHax extends PolymerElement {\n  static get template() {\n    return html`\n      <style>\n        :host {\n          display: block;\n        }\n      </style>\n      <textarea id\\$=\"[[fieldId]]\" name=\"[[fieldName]]\" hidden=\"\">\n[[bodyValue]]</textarea\n      >\n      <cms-hax\n        open-default=\"[[openDefault]]\"\n        hide-message=\"\"\n        body-offset-left=\"[[bodyOffsetLeft]]\"\n        update-page-data=\"[[updatePageData]]\"\n        end-point=\"[[endPoint]]\"\n        app-store-connection=\"[[appStoreConnection]]\"\n        hide-export-button=\"[[hideExportButton]]\"\n        align=\"[[align]]\"\n      >\n      </cms-hax>\n    `;\n  }\n\n  static get tag() {\n    return \"wysiwyg-hax\";\n  }\n\n  static get properties() {\n    return {\n      /**\n       * Default the panel to open\n       */\n      openDefault: {\n        type: Boolean,\n        value: false\n      },\n      /**\n       * Hide the export button, not a common thing to show\n       * in this mode but it's possible for debugging\n       */\n      hideExportButton: {\n        type: Boolean,\n        value: true\n      },\n      /**\n       * Direction to align the hax edit panel\n       */\n      align: {\n        type: String,\n        value: \"right\"\n      },\n      /**\n       * Data binding of a hidden text area with the value from the hax-body tag\n       */\n      bodyValue: {\n        type: String\n      },\n      /**\n       * Connection object for talking to an app store.\n       */\n      appStoreConnection: {\n        type: Object\n      },\n      /**\n       * fieldId, id value on the input field.\n       */\n      fieldId: {\n        type: String,\n        value: \"textarea-input-field\"\n      },\n      /**\n       * fieldName, internal to the form in whatever system it's in.\n       */\n      fieldName: {\n        type: String,\n        value: \"data[content]\"\n      },\n      /**\n       * Offset from the left of the body field\n       */\n      bodyOffsetLeft: {\n        type: Number,\n        value: -22\n      },\n      /**\n       * State of the panel\n       */\n      editMode: {\n        type: Boolean,\n        reflectToAttribute: true\n      },\n      /**\n       * Location to save content to.\n       */\n      endPoint: {\n        type: String\n      },\n      /**\n       * Page data, body of text as a string.\n       */\n      updatePageData: {\n        type: String\n      },\n      /**\n       * Reference to activeBody.\n       */\n      activeHaxBody: {\n        type: Object,\n        observer: \"_activeHaxBodyUpdated\"\n      },\n      __imported: {\n        type: Boolean,\n        value: false\n      }\n    };\n  }\n  /**\n   * highjack shadowDom\n   */\n  _attachDom(dom) {\n    this.appendChild(dom);\n  }\n\n  /**\n   * Ensure we've imported our content on initial setup\n   */\n  _activeHaxBodyUpdated(newValue, oldValue) {\n    // ensure we import our content once we get an initial registration of active body\n    if (newValue != null && !this.__imported) {\n      this.__imported = true;\n      // see what's inside of this, in a template tag\n      let children = this.querySelector(\"template\");\n      // convert this template content into the real thing\n      // this helps with correctly preserving everything on the way down\n      if (children != null) {\n        newValue.importContent(children.innerHTML);\n        // need to dot his because of juggling unfortunately\n        this.editMode = false;\n        window.HaxStore.write(\"editMode\", this.editMode, this);\n        setTimeout(() => {\n          this.editMode = true;\n          window.HaxStore.write(\"editMode\", this.editMode, this);\n        }, 200);\n      }\n    }\n  }\n  connectedCallback() {\n    super.connectedCallback();\n    document.body.addEventListener(\n      \"hax-save\",\n      this._bodyContentUpdated.bind(this)\n    );\n    document.body.addEventListener(\n      \"hax-store-property-updated\",\n      this._haxStorePropertyUpdated.bind(this)\n    );\n  }\n  disconnectedCallback() {\n    document.body.removeEventListener(\n      \"hax-save\",\n      this._bodyContentUpdated.bind(this)\n    );\n    document.body.removeEventListener(\n      \"hax-store-property-updated\",\n      this._haxStorePropertyUpdated.bind(this)\n    );\n    super.disconnectedCallback();\n  }\n  /**\n   * Store updated, sync.\n   */\n  _haxStorePropertyUpdated(e) {\n    if (\n      e.detail &&\n      typeof e.detail.value !== typeof undefined &&\n      e.detail.property\n    ) {\n      if (typeof e.detail.value === \"object\") {\n        this.set(e.detail.property, null);\n      }\n      this.set(e.detail.property, e.detail.value);\n    }\n  }\n\n  /**\n   * Set the bubbled up event to the body value that just got changed\n   */\n  _bodyContentUpdated(e) {\n    this.bodyValue = window.HaxStore.instance.activeHaxBody.haxToContent();\n  }\n}\nwindow.customElements.define(WysiwygHax.tag, WysiwygHax);\nexport { WysiwygHax };\n"],"names":["WysiwygHax","PolymerElement","html","openDefault","type","Boolean","value","hideExportButton","align","String","bodyValue","appStoreConnection","Object","fieldId","fieldName","bodyOffsetLeft","Number","editMode","reflectToAttribute","endPoint","updatePageData","activeHaxBody","observer","__imported","dom","appendChild","newValue","oldValue","this","children","querySelector","importContent","innerHTML","window","HaxStore","write","setTimeout","_this","document","body","addEventListener","_bodyContentUpdated","bind","_haxStorePropertyUpdated","removeEventListener","e","detail","_typeof","property","set","instance","haxToContent","customElements","define","tag"],"mappings":"i2FAQMA,gaAAmBC,+DAEdC,8CAwBA,uDAIA,CAILC,YAAa,CACXC,KAAMC,QACNC,OAAO,GAMTC,iBAAkB,CAChBH,KAAMC,QACNC,OAAO,GAKTE,MAAO,CACLJ,KAAMK,OACNH,MAAO,SAKTI,UAAW,CACTN,KAAMK,QAKRE,mBAAoB,CAClBP,KAAMQ,QAKRC,QAAS,CACPT,KAAMK,OACNH,MAAO,wBAKTQ,UAAW,CACTV,KAAMK,OACNH,MAAO,iBAKTS,eAAgB,CACdX,KAAMY,OACNV,OAAQ,IAKVW,SAAU,CACRb,KAAMC,QACNa,oBAAoB,GAKtBC,SAAU,CACRf,KAAMK,QAKRW,eAAgB,CACdhB,KAAMK,QAKRY,cAAe,CACbjB,KAAMQ,OACNU,SAAU,yBAEZC,WAAY,CACVnB,KAAMC,QACNC,OAAO,4CAOFkB,QACJC,YAAYD,iDAMGE,EAAUC,iBAEd,MAAZD,IAAqBE,KAAKL,WAAY,MACnCA,YAAa,MAEdM,EAAWD,KAAKE,cAAc,YAGlB,MAAZD,IACFH,EAASK,cAAcF,EAASG,gBAE3Bf,UAAW,EAChBgB,OAAOC,SAASC,MAAM,WAAYP,KAAKX,SAAUW,MACjDQ,WAAW,WACTC,EAAKpB,UAAW,EAChBgB,OAAOC,SAASC,MAAM,WAAYE,EAAKpB,SAAUoB,IAChD,yGAMPC,SAASC,KAAKC,iBACZ,WACAZ,KAAKa,oBAAoBC,KAAKd,OAEhCU,SAASC,KAAKC,iBACZ,6BACAZ,KAAKe,yBAAyBD,KAAKd,sDAIrCU,SAASC,KAAKK,oBACZ,WACAhB,KAAKa,oBAAoBC,KAAKd,OAEhCU,SAASC,KAAKK,oBACZ,6BACAhB,KAAKe,yBAAyBD,KAAKd,iHAOdiB,GAErBA,EAAEC,sBACFC,EAAOF,EAAEC,OAAOxC,QAChBuC,EAAEC,OAAOE,WAEqB,WAA1BD,EAAOF,EAAEC,OAAOxC,aACb2C,IAAIJ,EAAEC,OAAOE,SAAU,WAEzBC,IAAIJ,EAAEC,OAAOE,SAAUH,EAAEC,OAAOxC,oDAOrBuC,QACbnC,UAAYuB,OAAOC,SAASgB,SAAS7B,cAAc8B,oDAG5DlB,OAAOmB,eAAeC,OAAOrD,EAAWsD,IAAKtD"}