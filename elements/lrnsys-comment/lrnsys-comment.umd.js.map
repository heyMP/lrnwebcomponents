{"version":3,"file":"lrnsys-comment.umd.js","sources":["lrnsys-comment.umd.js"],"sourcesContent":["/**\n * Copyright 2018 The Pennsylvania State University\n * @license Apache-2.0, see License.md for full text.\n */\nimport { html, PolymerElement } from \"@polymer/polymer/polymer-element.js\";\nimport { dom } from \"@polymer/polymer/lib/legacy/polymer.dom.js\";\nimport * as async from \"@polymer/polymer/lib/utils/async.js\";\nimport \"@polymer/paper-input/paper-textarea.js\";\nimport \"@lrnwebcomponents/materializecss-styles/lib/colors.js\";\nimport \"@lrnwebcomponents/mtz-marked-editor/mtz-marked-editor.js\";\nimport \"@lrnwebcomponents/mtz-marked-editor/lib/mtz-marked-control-generic-line.js\";\nimport \"@lrnwebcomponents/mtz-marked-editor/lib/mtz-marked-control-generic-wrap.js\";\nimport \"@lrnwebcomponents/mtz-marked-editor/lib/mtz-marked-control-link.js\";\nimport \"@lrnwebcomponents/word-count/word-count.js\";\nimport \"@lrnwebcomponents/lrnsys-button/lrnsys-button.js\";\nimport \"@lrnwebcomponents/lrndesign-avatar/lrndesign-avatar.js\";\n/**\n`lrnsys-comment`\nA well styled comment for a user with markdown support.\n\n* @demo demo/index.html\n*/\nclass LrnsysComment extends PolymerElement {\n  constructor() {\n    super();\n    import(\"@polymer/iron-icons/editor-icons.js\");\n    import(\"@polymer/paper-tooltip/paper-tooltip.js\");\n    import(\"@polymer/marked-element/marked-element.js\");\n    import(\"@polymer/paper-badge/paper-badge.js\");\n    import(\"@lrnwebcomponents/moment-element/moment-element.js\");\n  }\n  static get template() {\n    return html`\n      <style include=\"materializecss-styles-colors\">\n        :host {\n          display: block;\n          padding: 10px 10px 10px 0px;\n        }\n        :host([disabled]) {\n          opacity: 0.5;\n          background-color: #cccccc;\n          pointer-events: none;\n        }\n        :host(:focus),\n        :host(:hover) {\n          z-index: 2;\n        }\n        :host(:focus) .comment-outer,\n        :host(:hover) .comment-outer {\n          border: 1px #0277bd solid;\n        }\n        :host [hidden] {\n          display: none;\n        }\n        .comment-outer {\n          display: table;\n          width: 100%;\n          border: 1px #ddd solid;\n          color: #444;\n        }\n        .comment-outer.new-comment {\n          border: 1px #d81b60 dashed;\n          color: #000;\n        }\n        .comment-inner {\n          display: table-row;\n        }\n        .comment-avatar {\n          padding: 0 7px;\n          width: 40px;\n        }\n        .comment-depth,\n        .comment-avatar,\n        .comment-content {\n          padding-top: 8px;\n          padding-bottom: 8px;\n          display: table-cell;\n          vertical-align: top;\n        }\n        .comment-content {\n          padding-right: 7px;\n          max-width: 300px;\n        }\n        h1,\n        h2,\n        h3,\n        h4 {\n          text-align: left;\n          font-size: 20px;\n          line-height: 20px;\n        }\n        h1.comment-heading,\n        h2.comment-heading,\n        h3.comment-heading,\n        h4.comment-heading {\n          margin-top: 7px;\n        }\n        p {\n          font-size: 14px;\n          line-height: 18px;\n          text-align: left;\n        }\n        #editcomment {\n          background-color: white;\n          padding: 4px;\n        }\n        marked-element {\n          line-height: 16px;\n          font-size: 14.4px;\n        }\n        .nowrap-me marked-element:hover {\n          box-shadow: -1px 0 0 0 black inset;\n          cursor: pointer;\n        }\n        .nowrap-me marked-element ::slotted(#content p.marked-element) {\n          height: 32px;\n          overflow: hidden;\n          text-overflow: ellipsis;\n          margin-bottom: 35px;\n        }\n        .nowrap-me marked-element ::slotted(#content p.marked-element:after) {\n          content: \"see more\";\n          position: absolute;\n          bottom: 65px;\n          right: 17px;\n          color: #1976d2;\n        }\n        .comment-depth-1 {\n          width: 0;\n        }\n        .comment-depth-2 {\n          width: 54px;\n          border-right: 3px solid #ccc;\n        }\n        .comment-depth-3,\n        .comment-depth-4,\n        .comment-depth-5,\n        .comment-depth-6,\n        .comment-depth-7,\n        .comment-depth-8,\n        .comment-depth-9 {\n          width: 108px;\n          border-right: 3px solid #ccc;\n        }\n        .center {\n          padding: 0;\n        }\n        .circle {\n          border-radius: 50% !important;\n        }\n        .comment-actions {\n          margin: 0;\n          padding: 0;\n          display: block;\n          border-top: 1px solid #ddd;\n        }\n        .comment-actions lrnsys-button {\n          display: inline-flex;\n        }\n        .comment-actions .comment-actions-group {\n          margin: 0;\n          padding: 0;\n          display: block;\n        }\n        .comment-actions .comment-actions-group.left-actions {\n          float: left;\n        }\n        .comment-actions .comment-actions-group.right-actions {\n          float: right;\n        }\n        moment-element {\n          float: right;\n          font-size: 90%;\n          font-style: italic;\n          font-weight: normal;\n        }\n        paper-badge {\n          right: 0px;\n          top: 0px;\n        }\n        .like-icon-color {\n          color: #2196f3;\n        }\n        .element-invisible {\n          position: absolute;\n          left: -9999px;\n          top: 0;\n          width: 0;\n          height: 0;\n          overflow: hidden;\n        }\n      </style>\n      <div class\\$=\"comment-outer [[commentNew]]\">\n        <div class=\"comment-inner\">\n          <div\n            class\\$=\"comment-depth comment-depth-[[comment.attributes.threadDepth]] grey lighten-3\"\n          ></div>\n          <div class=\"comment-avatar\">\n            <lrndesign-avatar\n              id=\"avatar\"\n              label=\"[[comment.relationships.author.data.name]]\"\n              src=\"[[comment.relationships.author.data.avatar]]\"\n              class=\"float-left ferpa-protect\"\n            ></lrndesign-avatar>\n            <paper-tooltip\n              for=\"avatar\"\n              animation-delay=\"0\"\n              class=\"ferpa-protect\"\n              >[[displayName]]</paper-tooltip\n            >\n          </div>\n          <div class=\"comment-content\">\n            <div class=\"comment-body\">\n              <div id=\"bodyarea\" class=\"nowrap-me\">\n                <h4 class=\"ferpa-protect comment-heading\">\n                  <span class=\"element-invisible\">At </span\n                  ><moment-element\n                    datetime\\$=\"[[comment.attributes.created]]\"\n                    output-format=\"MMM DD[,] YYYY\"\n                  ></moment-element>\n                  [[comment.relationships.author.data.display_name]]\n                  <span class=\"element-invisible\"\n                    >[[comment.relationships.author.data.visual.label]]</span\n                  >\n                  said:\n                </h4>\n                <marked-element\n                  smartypants\n                  id=\"renderedcomment\"\n                  markdown=\"[[comment.attributes.body]]\"\n                >\n                  <word-count\n                    class=\"markdown-html-slot\"\n                    slot=\"markdown-html\"\n                  ></word-count>\n                </marked-element>\n              </div>\n              <mtz-marked-editor id=\"commenteditor\" hidden>\n                <div slot=\"controls\">\n                  <mtz-marked-control-generic-wrap\n                    icon=\"editor:format-bold\"\n                    title=\"Bold\"\n                    syntax-prefix=\"**\"\n                    syntax-suffix=\"**\"\n                    keys=\"ctrl+b\"\n                  ></mtz-marked-control-generic-wrap>\n                  <mtz-marked-control-generic-wrap\n                    icon=\"editor:format-italic\"\n                    title=\"Italic\"\n                    syntax-prefix=\"_\"\n                    syntax-suffix=\"_\"\n                    keys=\"ctrl+i\"\n                  ></mtz-marked-control-generic-wrap>\n                  <mtz-marked-control-generic-line\n                    icon=\"editor:format-size\"\n                    title=\"Heading 3\"\n                    syntax-prefix=\"### \"\n                  ></mtz-marked-control-generic-line>\n                  <mtz-marked-control-generic-line\n                    icon=\"editor:format-list-numbered\"\n                    title=\"Ordered List\"\n                    syntax-prefix=\"1. \"\n                  ></mtz-marked-control-generic-line>\n                  <mtz-marked-control-generic-line\n                    icon=\"editor:format-list-bulleted\"\n                    title=\"Unordered List\"\n                    syntax-prefix=\"- \"\n                  ></mtz-marked-control-generic-line>\n                  <mtz-marked-control-link\n                    icon=\"editor:insert-link\"\n                    title=\"Link\"\n                  ></mtz-marked-control-link>\n                </div>\n                <paper-textarea\n                  char-counter\n                  autofocus\n                  id=\"editcomment\"\n                  label=\"Comment\"\n                  value=\"{{comment.attributes.body}}\"\n                  slot=\"textarea\"\n                ></paper-textarea>\n              </mtz-marked-editor>\n            </div>\n            <div class=\"comment-actions\">\n              <div class=\"comment-actions-group left-actions\">\n                <lrnsys-button\n                  on-click=\"actionHandler\"\n                  id=\"reply\"\n                  data-commentid=\"[[comment.id]]\"\n                  alt=\"Reply\"\n                  icon=\"reply\"\n                  hover-class=\"[[hoverClass]]\"\n                  icon-class=\"grey-text no-margin\"\n                  hidden\\$=\"[[!comment.actions.reply]]\"\n                ></lrnsys-button>\n                <lrnsys-button\n                  on-click=\"actionHandler\"\n                  id=\"like\"\n                  data-commentid=\"[[comment.id]]\"\n                  alt=\"Like\"\n                  icon=\"thumb-up\"\n                  hover-class=\"[[hoverClass]]\"\n                  icon-class=\"grey-text no-margin\"\n                  hidden\\$=\"[[!comment.actions.like]]\"\n                ></lrnsys-button>\n              </div>\n              <div class=\"comment-actions-group right-actions\">\n                <lrnsys-button\n                  on-click=\"actionHandler\"\n                  id=\"edit\"\n                  data-commentid=\"[[comment.id]]\"\n                  icon=\"create\"\n                  alt=\"Edit\"\n                  hover-class=\"[[hoverClass]]\"\n                  icon-class=\"grey-text no-margin\"\n                  hidden\\$=\"[[!comment.actions.edit]]\"\n                ></lrnsys-button>\n                <lrnsys-button\n                  on-click=\"actionHandler\"\n                  id=\"delete\"\n                  data-commentid=\"[[comment.id]]\"\n                  icon=\"delete-forever\"\n                  alt=\"Delete\"\n                  hover-class=\"[[hoverClass]]\"\n                  icon-class=\"grey-text no-margin\"\n                  hidden\\$=\"[[!comment.actions.delete]]\"\n                ></lrnsys-button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      <template\n        is=\"dom-if\"\n        if=\"[[comment.relationships.author.data.visual.icon]]\"\n      >\n        <paper-badge\n          icon=\"[[comment.relationships.author.data.visual.icon]]\"\n          for=\"papercard\"\n          label=\"[[comment.relationships.author.data.visual.label]]\"\n        >\n        </paper-badge>\n      </template>\n    `;\n  }\n\n  static get tag() {\n    return \"lrnsys-comment\";\n  }\n\n  static get properties() {\n    return {\n      comment: {\n        type: Object,\n        notify: true,\n        observer: \"_commentLoaded\"\n      },\n      displayName: {\n        type: String,\n        notify: true,\n        computed:\n          \"_generateName(comment.relationships.author.data.display_name, comment.relationships.author.data.visual)\"\n      },\n      commentNew: {\n        type: String,\n        notify: true,\n        computed: \"_isCommentNew(comment.relationships.author.data.visual)\"\n      },\n      hoverClass: {\n        type: String,\n        reflectToAttribute: true\n      },\n      editform: {\n        type: Boolean,\n        notify: true,\n        observer: \"_editTrigger\",\n        reflectToAttribute: true\n      },\n      disabled: {\n        type: Boolean,\n        notify: true,\n        reflectToAttribute: true\n      }\n    };\n  }\n\n  /**\n   * attached lifecycle\n   */\n  connectedCallback() {\n    super.connectedCallback();\n    this.$.bodyarea.addEventListener(\"click\", this.bodyToggle.bind(this));\n    this.$.bodyarea.addEventListener(\"dblclick\", this.bodyToggleOn.bind(this));\n  }\n  /**\n   * detached lifecycle\n   */\n  disconnectedCallback() {\n    super.disconnectedCallback();\n    this.$.bodyarea.removeEventListener(\"click\", this.bodyToggle.bind(this));\n    this.$.bodyarea.removeEventListener(\n      \"dblclick\",\n      this.bodyToggleOn.bind(this)\n    );\n  }\n\n  _generateName(name, visual) {\n    if (typeof visual !== typeof undefined && visual.label !== false) {\n      return name + \" (\" + visual.label + \")\";\n    }\n    return name;\n  }\n\n  _isCommentNew(visual) {\n    if (typeof visual !== typeof undefined && visual.label !== false) {\n      return \"new-comment\";\n    }\n    return \"\";\n  }\n\n  _commentLoaded(e) {\n    this.editform = this.comment.metadata.editing;\n    this.disabled = this.comment.metadata.disabled;\n    this.blockFirstState = true;\n  }\n\n  /**\n   * Handle all actions from the button bar.\n   */\n  actionHandler(e) {\n    // convert click handler into local dom object\n    var normalizedEvent = dom(e);\n    var target = normalizedEvent.localTarget;\n    var comment = null;\n    // ensure we have a comment ID to operate against\n    if (target.dataCommentid != null && !target.disabled) {\n      comment = target.dataCommentid;\n      // handle the type of event requested\n      if (target.id == \"reply\") {\n        this.dispatchEvent(\n          new CustomEvent(\"comment-reply\", {\n            bubbles: true,\n            cancelable: true,\n            composed: true,\n            detail: { comment: this.comment, target: target }\n          })\n        );\n      } else if (target.id == \"like\") {\n        this.$.like.classList.toggle(\"like-icon-color\");\n        this.dispatchEvent(\n          new CustomEvent(\"comment-like\", {\n            bubbles: true,\n            cancelable: true,\n            composed: true,\n            detail: { comment: this.comment, target: target }\n          })\n        );\n      } else if (target.id == \"edit\") {\n        // toggle edit, allow edit state handle itself via observer\n        this.editform = !this.editform;\n      } else if (target.id == \"delete\") {\n        this.dispatchEvent(\n          new CustomEvent(\"comment-delete-dialog\", {\n            bubbles: true,\n            cancelable: true,\n            composed: true,\n            detail: {\n              comment: this.comment,\n              target: target\n            }\n          })\n        );\n      }\n    }\n  }\n\n  /**\n   * Trigger the edit form.\n   */\n  _editTrigger(e) {\n    // bother checking if they can edit or not first\n    if (typeof this.comment !== typeof undefined && this.comment.actions.edit) {\n      async.microTask.run(() => {\n        // show / hide the edit vs display area\n        this.$.renderedcomment.hidden = this.editform;\n        this.$.commenteditor.hidden = !this.editform;\n        // simple icon toggle\n        if (this.editform) {\n          this.$.edit.icon = \"save\";\n          this.$.edit.alt = \"Save\";\n          this.$.reply.disabled = true;\n          this.$.editcomment.focus();\n          this.dispatchEvent(\n            new CustomEvent(\"comment-editing\", {\n              bubbles: true,\n              cancelable: true,\n              composed: true,\n              detail: { comment: this.comment }\n            })\n          );\n          this.blockFirstState = false;\n        } else {\n          if (!this.blockFirstState) {\n            this.dispatchEvent(\n              new CustomEvent(\"comment-save\", {\n                bubbles: true,\n                cancelable: true,\n                composed: true,\n                detail: { comment: this.comment }\n              })\n            );\n          } else {\n            this.blockFirstState = false;\n          }\n          this.$.edit.icon = \"create\";\n          this.$.edit.alt = \"Edit\";\n          this.$.reply.disabled = false;\n        }\n      });\n    }\n  }\n  /**\n   * Toggle the body field expanding to show the whole comment\n   */\n  bodyToggle(e) {\n    this.$.bodyarea.classList.remove(\"nowrap-me\");\n  }\n\n  /**\n   * Toggle the body field expanding to show the whole comment\n   */\n  bodyToggleOn(e) {\n    this.$.bodyarea.classList.toggle(\"nowrap-me\");\n  }\n}\nwindow.customElements.define(LrnsysComment.tag, LrnsysComment);\nexport { LrnsysComment };\n"],"names":["LrnsysComment","PolymerElement","html","comment","type","Object","notify","observer","displayName","String","computed","commentNew","hoverClass","reflectToAttribute","editform","Boolean","disabled","$","bodyarea","addEventListener","this","bodyToggle","bind","bodyToggleOn","removeEventListener","name","visual","_typeof","label","e","metadata","editing","blockFirstState","target","dom","localTarget","dataCommentid","id","dispatchEvent","CustomEvent","bubbles","cancelable","composed","detail","like","classList","toggle","actions","edit","async","run","_this2","renderedcomment","hidden","commenteditor","icon","alt","reply","editcomment","focus","remove","window","customElements","define","tag"],"mappings":"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"}